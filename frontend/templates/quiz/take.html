{% extends "base.html" %}

{% block title %}Taking Quiz: {{ quiz.title }}{% endblock %}

{% block content %}
<div class="quiz-take-page">
    <div class="container">
        <!-- Quiz Header with Timer -->
        <div class="quiz-header">
            <h2>{{ quiz.title }}</h2>
            <div class="quiz-timer" id="quizTimer">
                <i class="fas fa-clock"></i>
                <span id="timeRemaining">{{ quiz.duration_minutes }}:00</span>
            </div>
        </div>

        <form method="POST" action="{{ url_for('quiz.submit_quiz', attempt_id=attempt.attempt_id) }}" id="quizForm">
            <div class="quiz-questions">
                {% for question in questions %}
                    <div class="question-card" data-question-id="{{ question.question_id }}">
                        <div class="question-header">
                            <span class="question-number">Question {{ loop.index }} of {{ questions|length }}</span>
                            <span class="question-points">{{ question.points }} point(s)</span>
                        </div>

                        <div class="question-text">
                            <p>{{ question.question_text }}</p>
                        </div>

                        <div class="question-options">
                            {% if question.question_type == 'multiple_choice' or question.question_type == 'true_false' %}
                                {% for option in question.options.all() %}
                                    <label class="option-label">
                                        <input 
                                            type="radio" 
                                            name="question_{{ question.question_id }}" 
                                            value="{{ option.option_id }}"
                                            {% if existing_answers.get(question.question_id) and existing_answers.get(question.question_id).selected_option_id == option.option_id %}checked{% endif %}
                                            required
                                        >
                                        <span class="option-text">{{ option.option_text }}</span>
                                    </label>
                                {% endfor %}
                            {% elif question.question_type == 'short_answer' %}
                                <textarea 
                                    name="question_{{ question.question_id }}" 
                                    class="form-control" 
                                    rows="4" 
                                    placeholder="Type your answer here..."
                                    required
                                >{% if existing_answers.get(question.question_id) %}{{ existing_answers.get(question.question_id).answer_text }}{% endif %}</textarea>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Progress Bar -->
            <div class="quiz-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <p class="progress-text">
                    <span id="answeredCount">0</span> of {{ questions|length }} questions answered
                </p>
            </div>

            <!-- Submit Button -->
            <div class="quiz-submit-section">
                <button type="submit" class="btn btn-success btn-lg" onclick="return confirm('Are you sure you want to submit? You cannot change your answers after submission.');">
                    <i class="fas fa-check-circle"></i> Submit Quiz
                </button>
                <a href="{{ url_for('quiz.view_quiz', quiz_id=quiz.quiz_id) }}" 
                   class="btn btn-secondary"
                   onclick="return confirm('Are you sure you want to leave? Your progress will be saved.');">
                    Save and Exit
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}